<!doctype html>
<html>
  <body>
    <textarea id="rawdata", style="display:none;">
    # date,avtemp
    20150101,   30
    20150102,   73
    20150103,   38
    20150104,   39
    20150105,   24
    20150106,   28
    20150107,   45
    20150108,   65
    20150109,   99
    20150110,   95
    20150111,   64
    20150112,   84
    20150113,   86
    20150114,   44
    20150115,   79
    20150116,   55
    20150117,   30
    20150118,   22
    20150119,   10
    20150120,    8
    20150121,   -5
    20150122,  -12
    20150123,  -28
    20150124,   22
    20150125,   37
    20150126,   59
    20150127,   51
    20150128,   53
    20150129,   24
    20150130,   17
    20150131,   10
    20150201,   26
    20150202,   20
    20150203,   17
    20150204,    2
    20150205,   -7
    20150206,   -2
    20150207,   15
    20150208,   50
    20150209,   57
    20150210,   57
    20150211,   42
    20150212,   26
    20150213,   46
    20150214,   66
    20150215,   26
    20150216,    9
    20150217,   33
    20150218,   18
    20150219,   35
    20150220,   53
    20150221,   32
    20150222,   32
    20150223,   59
    20150224,   54
    20150225,   48
    20150226,   63
    20150227,   49
    20150228,   51
    20150301,   83
    20150302,   53
    20150303,   44
    20150304,   51
    20150305,   57
    20150306,   66
    20150307,   84
    20150308,   93
    20150309,   88
    20150310,   76
    20150311,   27
    20150312,   54
    20150313,   46
    20150314,   34
    20150315,   56
    20150316,   63
    20150317,   76
    20150318,   56
    20150319,   68
    20150320,   49
    20150321,   64
    20150322,   43
    20150323,   31
    20150324,   57
    20150325,   59
    20150326,   50
    20150327,   57
    20150328,   69
    20150329,   93
    20150330,   72
    20150331,   90
    20150401,   65
    20150402,   63
    20150403,   70
    20150404,   54
    20150405,   53
    20150406,   69
    20150407,   71
    20150408,   86
    20150409,  104
    20150410,  113
    20150411,   90
    20150412,  100
    20150413,   84
    20150414,  119
    20150415,  138
    20150416,   99
    20150417,   85
    20150418,   90
    20150419,   78
    20150420,  109
    20150421,  100
    20150422,   85
    20150423,   94
    20150424,  124
    20150425,  121
    20150426,  106
    20150427,   80
    20150428,   60
    20150429,   89
    20150430,   98
    20150501,   87
    20150502,   97
    20150503,  130
    20150504,  154
    20150505,  154
    20150506,  122
    20150507,  118
    20150508,  142
    20150509,  133
    20150510,  128
    20150511,  176
    20150512,  146
    20150513,  127
    20150514,  112
    20150515,   94
    20150516,  105
    20150517,  119
    20150518,  111
    20150519,  100
    20150520,  105
    20150521,  119
    20150522,  149
    20150523,  124
    20150524,  126
    20150525,  124
    20150526,  118
    20150527,  135
    20150528,  129
    20150529,  111
    20150530,  112
    20150531,  126
    20150601,  127
    20150602,  148
    20150603,  138
    20150604,  156
    20150605,  214
    20150606,  156
    20150607,  139
    20150608,  125
    20150609,  116
    20150610,  154
    20150611,  179
    20150612,  216
    20150613,  175
    20150614,  153
    20150615,  133
    20150616,  114
    20150617,  160
    20150618,  143
    20150619,  127
    20150620,  130
    20150621,  144
    20150622,  127
    20150623,  126
    20150624,  158
    20150625,  182
    20150626,  205
    20150627,  176
    20150628,  173
    20150629,  180
    20150630,  206
    20150701,  260
    20150702,  254
    20150703,  241
    20150704,  256
    20150705,  202
    20150706,  187
    20150707,  198
    20150708,  159
    20150709,  135
    20150710,  165
    20150711,  204
    20150712,  177
    20150713,  174
    20150714,  179
    20150715,  179
    20150716,  196
    20150717,  217
    20150718,  182
    20150719,  162
    20150720,  178
    20150721,  210
    20150722,  195
    20150723,  178
    20150724,  184
    20150725,  149
    20150726,  148
    20150727,  166
    20150728,  152
    20150729,  141
    20150730,  138
    20150731,  133
    20150801,  151
    20150802,  177
    20150803,  215
    20150804,  180
    20150805,  189
    20150806,  205
    20150807,  206
    20150808,  187
    20150809,  186
    20150810,  198
    20150811,  200
    20150812,  195
    20150813,  217
    20150814,  209
    20150815,  184
    20150816,  150
    20150817,  143
    20150818,  146
    20150819,  165
    20150820,  179
    20150821,  197
    20150822,  207
    20150823,  197
    20150824,  179
    20150825,  167
    20150826,  202
    20150827,  157
    20150828,  154
    20150829,  170
    20150830,  200
    20150831,  209
    20150901,  161
    20150902,  132
    20150903,  122
    20150904,  135
    20150905,  132
    20150906,  131
    20150907,  142
    20150908,  139
    20150909,  131
    20150910,  143
    20150911,  143
    20150912,  157
    20150913,  166
    20150914,  145
    20150915,  125
    20150916,  154
    20150917,  144
    20150918,  139
    20150919,  134
    20150920,  135
    20150921,  146
    20150922,  131
    20150923,  132
    20150924,  126
    20150925,  116
    20150926,  104
    20150927,  110
    20150928,  105
    20150929,  117
    20150930,  123
    20151001,  106
    20151002,  103
    20151003,  103
    20151004,  103
    20151005,  131
    20151006,  153
    20151007,  149
    20151008,  124
    20151009,  102
    20151010,  109
    20151011,   65
    20151012,   48
    20151013,   38
    20151014,   51
    20151015,   63
    20151016,   77
    20151017,   81
    20151018,   84
    20151019,  105
    20151020,   95
    20151021,   97
    20151022,  119
    20151023,  114
    20151024,  118
    20151025,   99
    20151026,  105
    20151027,  111
    20151028,  106
    20151029,  107
    20151030,  102
    20151031,   98
    20151101,   77
    20151102,   69
    20151103,   90
    20151104,  122
    20151105,  133
    20151106,  155
    20151107,  164
    20151108,  131
    20151109,  136
    20151110,  145
    20151111,  127
    20151112,  133
    20151113,  114
    20151114,   97
    20151115,  143
    20151116,  125
    20151117,  135
    20151118,  131
    20151119,  112
    20151120,   79
    20151121,   43
    20151122,   26
    20151123,   32
    20151124,   42
    20151125,   54
    20151126,   40
    20151127,   45
    20151128,   67
    20151129,  102
    20151130,   95
    20151201,   97
    20151202,  110
    20151203,   98
    20151204,   94
    20151205,   79
    20151206,  105
    20151207,  105
    20151208,   98
    20151209,   76
    20151210,   59
    20151211,   70
    20151212,   76
    20151213,   68
    20151214,   76
    20151215,   74
    20151216,  114
    20151217,  136
    20151218,  118
    20151219,  122
    20151220,  116
    20151221,  104
    20151222,  130
    20151223,  106
    20151224,   98
    20151225,   96
    20151226,  131
    20151227,  118
    20151228,   89
    20151229,   75
    20151230,   69
    20151231,   78
    </textarea>

    <canvas id = "mycanvas", width ="700", height="500"></canvas>

    <script>
      // load data into array seperated by newline
      var data = document.getElementById("rawdata");
      var split1 = data.value.split('\n');

      // seperate each of these lines by comma
      var split2 = [];

      for (i = 1; i < split1.length - 1; i++)
      {
        temp = split1[i].split(',');
        split2.push(temp)
      }

      // create array for storing temperatures (and an extra array for sorting)
      var temp = [];
      var temp1 = [];

      for (i = 0; i < split2.length; i++)
      {
        // add right temperature to an array 
        temp[i] = Number(split2[i][1]);
        temp1[i] = Number(split2[i][1]);
      }

      days = [];
      // create array with days ranging from 1 to length of dataset
      for (i = 0; i < temp.length; i++)
      {
        days[i] = i + 1;
      }

      function createTransform(domain, range){
        // create variables for min's and max's of canvas and data
        var range_max = range[1]
        var range_min = range[0]
        var domain_max = domain[1]
        var domain_min = domain[0]

        // determine alpha and beta coefficiÃ«nts
        var alpha = (range_max - range_min) / (domain_max - domain_min)
        var beta = range_max - (domain_max * alpha);

          // return function that calculates data coÃ¶rdinates on canvas
          return function(x){
            return alpha * x + beta;
          };
      }

      // store the bounds of temperature in two variables
      min_temp = -50
      max_temp = 300

      // store the min and max bounds of days in two variables
      min_days = days[0];
      max_days = days[days.length - 1];

      // safe the canvas element into a variable and render context
      var canvas = document.getElementById('mycanvas');
      var ctx = canvas.getContext('2d');

      // draw a box around the canvas
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(canvas.width, 0);
      ctx.lineTo(canvas.width, canvas.height);
      ctx.lineTo(0, canvas.height);
      ctx.lineTo(0, 0);
      ctx.stroke();

      // define the height and width for the actual graph, leaving space for axis labels
      graph_height = canvas.height - 60;
      graph_width = canvas.width - 10

      // define x-axis offset and y-axis offset
      x_offset = 60;
      y_offset = 30;

      // give a variable the transformation functions for temp and date
      var trans_temp = createTransform([min_temp, max_temp], [y_offset, graph_height]);
      var trans_days = createTransform([min_days, max_days], [x_offset, graph_width]);

      // draw x-axis 
      ctx.beginPath();
      ctx.moveTo(trans_days(min_days), trans_temp(max_temp));
      ctx.lineTo(trans_days(max_days), trans_temp(max_temp));
      ctx.stroke();

      // display information for days on the x-axis
      // first adding day 1 to it
      ctx.beginPath();
      ctx.moveTo(trans_days(days[0]), trans_temp(max_temp));
      ctx.lineTo(trans_days(days[0]), trans_temp(max_temp) + 5);
      ctx.stroke();
      // add text '1' to the x-axis for the first day
      ctx.font = "11px serif";
      ctx.textAlign = "center";
      ctx.strokeText(days[0], trans_days(days[0]), trans_temp(max_temp + 15));  

      // do the same for other days with an interval of 25
      for (i = 24; i < days.length; i += 25)
      {
        ctx.beginPath();
        ctx.moveTo(trans_days(days[i]), trans_temp(max_temp));
        ctx.lineTo(trans_days(days[i]), trans_temp(max_temp) + 5);
        ctx.stroke();

        // adding the days to the x-axis as text
        ctx.font = "11px serif";
        ctx.textAlign = "center";
        ctx.strokeText(days[i], trans_days(days[i]), trans_temp(max_temp + 15));  
      }

      // add a label to the x-axis
      ctx.font = "20px serif";
      ctx.fillText("Day of the Year (2015)", graph_width / 2, graph_height + 50);

      // draw y-axis
      ctx.beginPath();
      ctx.moveTo(trans_days(min_days), trans_temp(min_temp));
      ctx.lineTo(trans_days(min_days), trans_temp(max_temp));
      ctx.stroke();

      // display information on temperature on the y-axis as text
      for (i = 0; i <= max_temp + 50; i += 50)
      {
        ctx.beginPath();
        ctx.moveTo(trans_days(min_days), trans_temp(max_temp - i));
        ctx.lineTo(trans_days(min_days) - 5, trans_temp(max_temp - i));
        ctx.stroke();

        // adding the temperatures to the y-axis
        ctx.font = "11px serif";
        ctx.textAlign = "center";
        ctx.strokeText(i - 50, trans_days(min_days) - 15, trans_temp(max_temp - i) + 2);
      }

      // adding a label to the y-axis
      ctx.save();
      ctx.rotate(3 * Math.PI/2);
      ctx.font = "20px serif";
      ctx.fillText("Average Temperature (in 0.1 Celsius)", -250, 25);
      ctx.restore();

      // adding a titel to the graph
      ctx.font = "20px serif";
      ctx.textAlign = "center";
      ctx.fillText("Average Temperature in De Bilt (NL)", graph_width / 2 + y_offset, 20);

      // begin the graph line on january 1st, 2015
      ctx.beginPath();
      ctx.moveTo(graph_width + x_offset - trans_days(days[0]), graph_height - trans_temp(temp)[0]);

      // draw lines of datapoints of january 1st to december 31st of 2015
      for (i = 0; i < temp.length; i++)
      {
        ctx.lineTo(trans_days(days[i]), graph_height + y_offset - trans_temp(temp[i]));
      }
      ctx.stroke();

      // draw horizontal striped line to indicate minimal average temperature
      // first find minimum temperature
      temp1.sort(function(a, b){return a - b});
      min_temp = temp1[0];

      // then draw striped line
      ctx.setLineDash([5, 3]);
      ctx.beginPath();
      ctx.moveTo(x_offset, graph_height + y_offset - trans_temp(min_temp));
      ctx.lineTo(graph_width, graph_height + y_offset - trans_temp(min_temp));
      ctx.stroke();
    </script>
  </body>
</html>